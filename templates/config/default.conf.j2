{%- import '_macros.j2' as macros with context -%}

; supervisor config file
;
; For more information on the config file, please see:
; http://supervisord.org/configuration.html
;
; Notes:
;  - Shell expansion ("~" or "$HOME") is not supported.  Environment
;    variables can be expanded using this syntax: "%(ENV_HOME)s".
;  - Comments must have a leading space: "a=b ;comment" not "a=b;comment".

{% set config_unix_http_server = elao_supervisor_config.unix_http_server|default({}) -%}

[unix_http_server]
file={{ config_unix_http_server.file|default('/var/run/supervisor.sock') }} ; (the path to the socket file)
{{ macros.config(config_unix_http_server, ['file']) }}

{% set config_supervisord = elao_supervisor_config.supervisord|default({}) -%}

[supervisord]
logfile={{ config_supervisord.logfile|default('/var/log/supervisor/supervisord.log') }} ; (main log file;default $CWD/supervisord.log)
pidfile={{ config_supervisord.pidfile|default('/var/run/supervisord.pid') }}            ; (supervisord pidfile;default supervisord.pid)
childlogdir={{ config_supervisord.childlogdir|default('/var/log/supervisor') }}         ; ('AUTO' child log dir, default $TEMP)
{{ macros.config(config_supervisord, ['logfile', 'pidfile', 'childlogdir']) }}

; the below section must remain in the config file for RPC
; (supervisorctl/web interface) to work, additional interfaces may be
; added by defining them in separate rpcinterface: sections
[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

{% set config_supervisorctl = elao_supervisor_config.supervisorctl|default({}) -%}

[supervisorctl]
serverurl={{ config_supervisorctl.serverurl|default('unix:///var/run//supervisor.sock') }} ; use a unix:// URL  for a unix socket
{{ macros.config(config_supervisorctl, ['serverurl']) }}


; The [include] section can just contain the "files" setting.  This
; setting can list multiple files (separated by whitespace or
; newlines).  It can also contain wildcards.  The filenames are
; interpreted as relative to this file.  Included files *cannot*
; include files themselves.

{% set config_include = elao_supervisor_config.include|default({}) -%}

[include]
files = {{ config_include.childlogdir|default(elao_supervisor_configs_dir ~ '/*.conf') }}
{{ macros.config(config_include, ['files']) }}

{{ macros.config(elao_supervisor_config, ['unix_http_server', 'supervisord', 'config_supervisorctl', 'include']) }}
